import java.util
import java.util.Date

import org.apache.commons.lang3.StringUtils
import org.scalatestplus.play._
import utils.Util

import scala.io.Source

object TestLog extends App {
  /* val sc = Source.fromInputStream(System.in)
  sc.getLines().foreach{ line =>


  }*/

  val str =
    """
application-2018-03-24.0.log:[INFO  2018-03-24 14:38:09,849] [ForkJoinPool-2-worker-29 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689845, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521804313000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. timeout: time cost 566
application-2018-03-24.0.log:[INFO  2018-03-24 14:38:17,717] [ForkJoinPool-2-worker-13 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-24.0.log:[INFO  2018-03-24 14:38:25,271] [ForkJoinPool-2-worker-63 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-24.0.log:[INFO  2018-03-24 16:24:02,574] [ForkJoinPool-2-worker-43 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-24.0.log:[INFO  2018-03-24 16:24:07,743] [ForkJoinPool-2-worker-43 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-24.0.log:[INFO  2018-03-24 16:24:39,477] [ForkJoinPool-2-worker-59 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 5
application-2018-03-24.0.log:[INFO  2018-03-24 16:24:46,572] [ForkJoinPool-2-worker-59 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-26.0.log:[INFO  2018-03-26 08:26:57,357] [ForkJoinPool-2-worker-43 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217355, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. timeout: time cost 538
application-2018-03-27.0.log:[INFO  2018-03-27 10:56:31,657] [ForkJoinPool-2-worker-27 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-27.0.log:[INFO  2018-03-27 10:59:49,605] [ForkJoinPool-2-worker-33 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-27.0.log:[INFO  2018-03-27 11:48:06,821] [ForkJoinPool-2-worker-15 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-27.0.log:[INFO  2018-03-27 14:03:18,702] [ForkJoinPool-2-worker-35 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-27.0.log:[INFO  2018-03-27 14:06:02,937] [ForkJoinPool-2-worker-17 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 7
application-2018-03-27.0.log:[INFO  2018-03-27 19:34:55,967] [ForkJoinPool-2-worker-13 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 7

application-2018-03-24.0.log:[INFO  2018-03-24 14:38:37,251] [ForkJoinPool-2-worker-63 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-24.0.log:[INFO  2018-03-24 16:24:31,191] [ForkJoinPool-2-worker-27 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=cb9c1deca7a60fd2dbba6d52ba7a7a03, refreshToken=d4d90f785e6e35c2d38ab244c4c194a4, expireAt=1521880689000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1521873489000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-26.0.log:[INFO  2018-03-26 08:27:04,773] [ForkJoinPool-2-worker-35 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522024017000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 3
application-2018-03-26.0.log:[INFO  2018-03-26 08:28:52,822] [ForkJoinPool-2-worker-37 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522024017000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-26.0.log:[INFO  2018-03-26 08:29:01,084] [ForkJoinPool-2-worker-37 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522024017000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 2
application-2018-03-26.0.log:[INFO  2018-03-26 17:31:49,922] [ForkJoinPool-2-worker-3 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=binded, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522024017000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. timeout: time cost 1119
application-2018-03-26.0.log:[INFO  2018-03-26 17:32:01,560] [ForkJoinPool-2-worker-3 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056709000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-26.0.log:[INFO  2018-03-26 20:01:08,277] [ForkJoinPool-2-worker-19 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 5
application-2018-03-27.0.log:[INFO  2018-03-27 09:04:38,094] [ForkJoinPool-2-worker-43 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=1522056721000, providerName=272674037518305280, lastBindTime=1521624958000, refreshTokenExpireAt=-1}. time cost 4
application-2018-03-27.0.log:[INFO  2018-03-27 10:56:20,226] [ForkJoinPool-2-worker-1 c.x.a.a.d.AccountLinkDal] - getUserLinkInfo return result UserAccountLink{userId=840907289, providerId=272679777511407616, grantType=AuthCode, accessToken=1df22e9c42feb486a1541bb276e927e9, refreshToken=a94083cfb68e22b1af8689400d41dc32, expireAt=1522031217000, scope=, state=expired, openid=3OlPCJZ0Qbab9UrQrHPPUcye9xn1B8, oauthVersion=OAuth20, context=, updateTime=

    """.stripMargin

  str.split("\n").filter(StringUtils.isNotBlank).map { line =>
    var str = line.replaceAll("application[\\s\\S]*INFO", "").replaceAll("ForkJoinPool[\\s\\S]*UserAccountLink", "")
    val index = str.indexOf("}. time")
    str = if(index > 0) str.substring(0, index).trim else str
    val strs = StringUtils.split(str, s"{")
    val time = strs(0).replace("] [", "").trim
    val params = strs(1).split(",").map(_.split("=").map(_.trim)).filter(strs => List("state","lastBindTime","refreshToken","expireAt","accessToken","updateTime").contains(strs(0).trim)).filter(_.length > 0).map { strs =>
      strs.length match {
        case 1 => (strs(0), "")
        case _ =>
          if (List("lastBindTime","expireAt","updateTime").contains(strs(0))) {
            (strs(0), Util.sdf.format(new Date(strs(1).toLong)))
          } else {
            (strs(0), strs(1))
          }
      }
    }.toMap
    new LogResult(time, params)
  }.sortBy(_.time).reverse.map { result =>
    val (time, params) =(result.time,result.params)
      println(s"$time, $params")
  }
}


case class LogResult(time:String, params : Map[String,String])